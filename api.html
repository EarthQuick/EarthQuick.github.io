<!DOCTYPE HTML>
<html>
    <head>
        <title>EarthQuick RESTful API</title>
        <meta charset="utf-8" />
    </head>
    <body id="tbody">
        <script src="javascripts/json2.js"></script>
        <script>

            function createXHR(){  
                if(window.XMLHttpRequest){  
                    return new XMLHttpRequest();  
                }  
                else{  
                    return new ActiveXObject("Microsoft.XMLHTTP");  
                }  
            }

            function getAJAX(fn,url){  
                var xhr = createXHR();  
                xhr.open("GET",url,true);  
                xhr.onreadystatechange =  function(){  
                    if(xhr.readyState == 4){ 
                        if(xhr.status == 200){
                            var data = eval("(" + xhr.responseText + ")");  
                            fn(data);  
                        }  
                    }  
                }  
                xhr.send(null);  
            } 

            // Using JS simple way to parse input params
            function GetQueryString(name)
            {
                 var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                 var r = window.location.search.substr(1).match(reg);
                 if(r!=null)return  unescape(r[2]); return null;
            }

            function main(){

                var type = GetQueryString("time");
                var minmag = GetQueryString("minmag");

                if (type != null) {
                    var dst = ".json";
                    if (type == "past_hour") {
                        dst = "_hour" + dst;
                    } else if (type == "past_day") {
                        dst = "_day" + dst;
                    } else if (type == "past_week") {
                        dst = "_week" + dst;
                    } else {
                        dst = "_month" + dst;
                    }

                    if (minmag == "3.0") {
                        dst = "3.0" + dst;
                    } else if (minmag == "5.0") {
                        dst = "5.0" + dst;
                    } else {
                        dst = "1.0" + dst;
                    }
                    
                    var url = "https://earthquick.github.io/data/" + dst;

                    getAJAX(function(data){
                        var t = eval(data);
                        document.getElementById("tbody").innerHTML = JSON.stringify(t);
                    },url);
                } else {

                }
            } 

            window.onload=main; 
        </script>

    </body>
</html>