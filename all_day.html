<!DOCTYPE HTML>
<html>
    <head>
        <title>EarthQuick RESTful API</title>
        <meta charset="utf-8" />
    </head>
    <body id="tbody">
        <script src="javascripts/json2.js"></script>
        <script>

            function createXHR(){  
                if(window.XMLHttpRequest){  
                    return new XMLHttpRequest();  
                }  
                else{  
                    return new ActiveXObject("Microsoft.XMLHTTP");  
                }  
            }

            function getAJAX(fn,url){  
                var xhr = createXHR();  
                xhr.open("GET",url,true);  
                xhr.onreadystatechange =  function(){  
                    if(xhr.readyState == 4){//异步请求时的状态码4代表数据接收完毕  
                        if(xhr.status == 200){//HTTP的状态 成功  
                            var data = eval("(" + xhr.responseText + ")");  
                            fn(data);//实现函数的回调,将结果返回  
                        }  
                    }  
                }  
                xhr.send(null);  
            } 

            // Using JS simple way to parse input params
            function GetQueryString(name)
            {
                 var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
                 var r = window.location.search.substr(1).match(reg);
                 if(r!=null)return  unescape(r[2]); return null;
            }

            function JsonToStr(o) {
                var arr = [];
                var fmt = function(s) {
                if (typeof s == 'object' && s != null) return JsonToStr(s);
                return /^(string|number)$/.test(typeof s) ? "'" + s + "'" : s;
                }
                for (var i in o) arr.push("'" + i + "':" + fmt(o[i]));
                return '{' + arr.join(',') + '}';
            }
            
            function main(){
                if (GetQueryString("test") != null) {
                    var url = "http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";

                    getAJAX(function(data){
                        var t = eval(data);
                        document.getElementById("tbody").innerHTML = JsonToStr(t.features);
                    },url);
                }
            } 

            window.onload=main; 
        </script>

    </body>
</html>